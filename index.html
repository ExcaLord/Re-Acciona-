<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Re-Acciona Plus- Clasificador Inteligente de Residuos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .camera-container {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 75%;
        overflow: hidden;
        border-radius: 1rem;
        background-color: #1a1a1a;
      }

      #camera-view {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .result-card {
        transition: all 0.3s ease;
        transform: translateY(20px);
        opacity: 0;
      }

      .result-card.show {
        transform: translateY(0);
        opacity: 1;
      }

      .waste-type {
        transition: all 0.3s ease;
      }

      .waste-type:hover {
        transform: scale(1.05);
      }

      .ai-chat {
        height: 400px;
        overflow-y: auto;
        scrollbar-width: thin;
      }

      .pulse-animation {
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .file-upload-label {
        transition: all 0.3s ease;
      }

      .file-upload-label:hover {
        background-color: #e2e8f0;
      }

      .file-upload-label.drag-over {
        background-color: #cbd5e0;
        transform: scale(1.02);
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="text-center mb-12">
        <h1 class="text-4xl font-bold text-green-600 mb-2">Re-Acciona Plus</h1>
        <p class="text-gray-600 text-lg">
          Tu asistente inteligente para el reciclaje
        </p>
        <div class="w-24 h-1 bg-green-500 mx-auto mt-4 rounded-full"></div>
      </header>

      <!-- Main App Section -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
        <!-- Camera/Upload Section -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold text-gray-800">
              Clasificar Residuo
            </h2>
            <div class="flex space-x-2">
              <button
                id="camera-btn"
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
              >
                <i class="fas fa-camera mr-2"></i>Cámara
              </button>
              <button
                id="upload-btn"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"
              >
                <i class="fas fa-upload mr-2"></i>Subir
              </button>
            </div>
          </div>

          <!-- Camera View -->
          <div id="camera-section" class="mb-6 hidden">
            <div class="camera-container mb-4">
              <video id="camera-view" autoplay playsinline></video>
            </div>
            <div class="flex justify-center space-x-4">
              <button
                id="capture-btn"
                class="px-6 py-3 bg-green-600 text-white rounded-full hover:bg-green-700 transition pulse-animation"
              >
                <i class="fas fa-camera-retro text-xl"></i>
              </button>
              <button
                id="switch-camera"
                class="px-6 py-3 bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 transition"
              >
                <i class="fas fa-sync-alt text-xl"></i>
              </button>
            </div>
          </div>

          <!-- Upload View -->
          <div id="upload-section" class="mb-6 hidden">
            <label
              id="file-upload-label"
              for="file-upload"
              class="file-upload-label flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-xl p-12 cursor-pointer hover:border-gray-400 transition"
            >
              <i
                class="fas fa-cloud-upload-alt text-5xl text-blue-500 mb-4"
              ></i>
              <p class="text-lg font-medium text-gray-700">
                Arrastra y suelta tu imagen aquí
              </p>
              <p class="text-sm text-gray-500 mt-2">
                o haz clic para seleccionar
              </p>
              <input
                id="file-upload"
                type="file"
                accept="image/*"
                class="hidden"
              />
            </label>
            <div id="upload-preview" class="mt-4 hidden">
              <img
                id="uploaded-image"
                src=""
                alt="Preview"
                class="rounded-xl max-h-64 mx-auto"
              />
            </div>
          </div>

          <!-- Result Section -->
          <div id="result-section" class="hidden">
            <div class="result-card bg-gray-50 rounded-xl p-6 mb-6">
              <h3 class="text-xl font-semibold text-gray-800 mb-4">
                Resultado del análisis
              </h3>
              <div id="result-content" class="flex flex-col items-center">
                <!-- Result will be inserted here -->
              </div>
            </div>

            <button
              id="new-analysis"
              class="w-full py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
            >
              <i class="fas fa-redo mr-2"></i>Realizar nuevo análisis
            </button>
          </div>

          <!-- Initial View -->
          <div id="initial-view" class="text-center py-12">
            <i class="fas fa-recycle text-6xl text-green-500 mb-6"></i>
            <h3 class="text-xl font-medium text-gray-700 mb-2">
              Comienza a clasificar tus residuos
            </h3>
            <p class="text-gray-500">
              Usa la cámara o sube una foto para identificar el tipo de residuo
              y cómo reciclarlo
            </p>
          </div>
        </div>

        <!-- AI Chat Section -->
        <div class="bg-white rounded-xl shadow-lg p-6">
          <div class="flex items-center mb-6">
            <div
              class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center mr-3"
            >
              <i class="fas fa-robot text-purple-600"></i>
            </div>
            <h2 class="text-2xl font-semibold text-gray-800">
              Asistente de Reciclaje
            </h2>
          </div>

          <div id="ai-chat" class="ai-chat mb-4 bg-gray-50 rounded-lg p-4">
            <div class="chat-message ai-message mb-4">
              <div class="flex items-start">
                <div
                  class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-3"
                >
                  <i class="fas fa-robot text-purple-600 text-sm"></i>
                </div>
                <div class="bg-white p-3 rounded-lg shadow-sm max-w-[85%]">
                  <p class="text-gray-700">
                    ¡Hola! Soy tu asistente de reciclaje. Puedes preguntarme
                    cualquier duda sobre cómo reciclar, reutilizar o gestionar
                    residuos. También puedo ayudarte con los resultados de tus
                    análisis.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="flex">
            <input
              id="ai-input"
              type="text"
              placeholder="Escribe tu pregunta sobre reciclaje..."
              class="flex-1 px-4 py-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
            />
            <button
              id="ai-send"
              class="px-4 py-2 bg-purple-600 text-white rounded-r-lg hover:bg-purple-700 transition"
            >
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>

          <div class="mt-6">
            <h3 class="text-lg font-medium text-gray-700 mb-3">
              Tipos de residuos comunes
            </h3>
            <div class="grid grid-cols-2 gap-3">
              <div
                class="waste-type bg-blue-50 p-3 rounded-lg border border-blue-100 cursor-pointer"
              >
                <div class="flex items-center">
                  <div
                    class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-2"
                  >
                    <i class="fas fa-trash text-blue-600 text-sm"></i>
                  </div>
                  <span class="font-medium">Orgánico</span>
                </div>
              </div>
              <div
                class="waste-type bg-yellow-50 p-3 rounded-lg border border-yellow-100 cursor-pointer"
              >
                <div class="flex items-center">
                  <div
                    class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center mr-2"
                  >
                    <i class="fas fa-recycle text-yellow-600 text-sm"></i>
                  </div>
                  <span class="font-medium">Plástico</span>
                </div>
              </div>
              <div
                class="waste-type bg-green-50 p-3 rounded-lg border border-green-100 cursor-pointer"
              >
                <div class="flex items-center">
                  <div
                    class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center mr-2"
                  >
                    <i class="fas fa-leaf text-green-600 text-sm"></i>
                  </div>
                  <span class="font-medium">Papel/Cartón</span>
                </div>
              </div>
              <div
                class="waste-type bg-red-50 p-3 rounded-lg border border-red-100 cursor-pointer"
              >
                <div class="flex items-center">
                  <div
                    class="w-8 h-8 rounded-full bg-red-100 flex items-center justify-center mr-2"
                  >
                    <i
                      class="fas fa-battery-three-quarters text-red-600 text-sm"
                    ></i>
                  </div>
                  <span class="font-medium">Peligroso</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <footer class="text-center text-gray-500 text-sm mt-12">
        <p>
          Re-Acciona Plus - Clasificación inteligente de residuos para un
          planeta más limpio
        </p>
        <p class="mt-1">© 2025 Todos los derechos reservados</p>
      </footer>
    </div>

    <script>
      // DOM Elements
      const cameraBtn = document.getElementById("camera-btn");
      const uploadBtn = document.getElementById("upload-btn");
      const cameraSection = document.getElementById("camera-section");
      const uploadSection = document.getElementById("upload-section");
      const initialView = document.getElementById("initial-view");
      const resultSection = document.getElementById("result-section");
      const cameraView = document.getElementById("camera-view");
      const captureBtn = document.getElementById("capture-btn");
      const switchCameraBtn = document.getElementById("switch-camera");
      const fileUpload = document.getElementById("file-upload");
      const fileUploadLabel = document.getElementById("file-upload-label");
      const uploadPreview = document.getElementById("upload-preview");
      const uploadedImage = document.getElementById("uploaded-image");
      const resultContent = document.getElementById("result-content");
      const newAnalysisBtn = document.getElementById("new-analysis");
      const aiChat = document.getElementById("ai-chat");
      const aiInput = document.getElementById("ai-input");
      const aiSend = document.getElementById("ai-send");

      // Camera variables
      let stream = null;
      let facingMode = "environment";

      // Waste types data
      const wasteTypes = {
        organic: {
          name: "Orgánico",
          color: "bg-green-100",
          textColor: "text-green-800",
          icon: "fas fa-trash",
          description:
            "Residuos biodegradables como restos de comida, cáscaras, etc.",
          disposal: "Contenedor marrón o compostera",
          tips: "Puedes compostar estos residuos para crear abono natural.",
        },
        plastic: {
          name: "Plástico",
          color: "bg-yellow-100",
          textColor: "text-yellow-800",
          icon: "fas fa-recycle",
          description: "Envases, botellas, bolsas y otros productos plásticos.",
          disposal: "Contenedor amarillo",
          tips: "Lava los envases antes de reciclarlos. Reduce el uso de plásticos de un solo uso.",
        },
        paper: {
          name: "Papel/Cartón",
          color: "bg-blue-100",
          textColor: "text-blue-800",
          icon: "fas fa-file-alt",
          description:
            "Periódicos, revistas, cajas de cartón, papel de oficina, etc.",
          disposal: "Contenedor azul",
          tips: "Aplana las cajas para ahorrar espacio. No recicles papel sucio o con restos de comida.",
        },
        glass: {
          name: "Vidrio",
          color: "bg-purple-100",
          textColor: "text-purple-800",
          icon: "fas fa-wine-bottle",
          description: "Botellas, frascos y otros envases de vidrio.",
          disposal: "Contenedor verde",
          tips: "Quita tapas y corchos antes de reciclar. No mezcles con cerámica o cristal.",
        },
        metal: {
          name: "Metal",
          color: "bg-gray-100",
          textColor: "text-gray-800",
          icon: "fas fa-cogs",
          description:
            "Latas, tapas, papel aluminio y otros objetos metálicos.",
          disposal:
            "Contenedor amarillo (envases) o punto limpio (otros metales)",
          tips: "Aplasta las latas para ahorrar espacio. Separa los metales ferrosos y no ferrosos.",
        },
        hazardous: {
          name: "Peligroso",
          color: "bg-red-100",
          textColor: "text-red-800",
          icon: "fas fa-biohazard",
          description:
            "Baterías, productos químicos, medicamentos, electrónicos.",
          disposal: "Punto limpio o contenedores especiales",
          tips: "Nunca tires estos residuos a la basura normal. Sigue las instrucciones de eliminación.",
        },
      };

      // Event Listeners
      cameraBtn.addEventListener("click", () => {
        initialView.classList.add("hidden");
        uploadSection.classList.add("hidden");
        resultSection.classList.add("hidden");
        cameraSection.classList.remove("hidden");
        startCamera();
      });

      uploadBtn.addEventListener("click", () => {
        initialView.classList.add("hidden");
        cameraSection.classList.add("hidden");
        resultSection.classList.add("hidden");
        uploadSection.classList.remove("hidden");
        stopCamera();
      });

      newAnalysisBtn.addEventListener("click", () => {
        resultSection.classList.add("hidden");
        initialView.classList.remove("hidden");
      });

      captureBtn.addEventListener("click", captureImage);
      switchCameraBtn.addEventListener("click", switchCamera);

      fileUpload.addEventListener("change", handleFileUpload);

      // Drag and drop events
      fileUploadLabel.addEventListener("dragover", (e) => {
        e.preventDefault();
        fileUploadLabel.classList.add("drag-over");
      });

      fileUploadLabel.addEventListener("dragleave", () => {
        fileUploadLabel.classList.remove("drag-over");
      });

      fileUploadLabel.addEventListener("drop", (e) => {
        e.preventDefault();
        fileUploadLabel.classList.remove("drag-over");
        if (e.dataTransfer.files.length) {
          fileUpload.files = e.dataTransfer.files;
          handleFileUpload();
        }
      });

      // AI Chat functionality
      aiSend.addEventListener("click", sendAiMessage);
      aiInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") {
          sendAiMessage();
        }
      });

      // Waste type click events
      document.querySelectorAll(".waste-type").forEach((type) => {
        type.addEventListener("click", () => {
          const wasteName = type
            .querySelector("span")
            .textContent.toLowerCase();
          let wasteKey = "";

          if (wasteName.includes("orgánico")) wasteKey = "organic";
          else if (wasteName.includes("plástico")) wasteKey = "plastic";
          else if (wasteName.includes("papel") || wasteName.includes("cartón"))
            wasteKey = "paper";
          else if (wasteName.includes("peligroso")) wasteKey = "hazardous";

          if (wasteKey) {
            askAboutWaste(wasteKey);
          }
        });
      });

      // Functions
      async function startCamera() {
        try {
          const constraints = {
            video: {
              facingMode: facingMode,
              width: { ideal: 1280 },
              height: { ideal: 720 },
            },
          };

          stream = await navigator.mediaDevices.getUserMedia(constraints);
          cameraView.srcObject = stream;
        } catch (err) {
          console.error("Error al acceder a la cámara:", err);
          alert(
            "No se pudo acceder a la cámara. Asegúrate de haber dado los permisos necesarios.",
          );
        }
      }

      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          stream = null;
          cameraView.srcObject = null;
        }
      }

      function switchCamera() {
        facingMode = facingMode === "user" ? "environment" : "user";
        stopCamera();
        startCamera();
      }

      function captureImage() {
        if (!stream) return;

        // Create canvas to capture image
        const canvas = document.createElement("canvas");
        canvas.width = cameraView.videoWidth;
        canvas.height = cameraView.videoHeight;
        const ctx = canvas.getContext("2d");
        ctx.drawImage(cameraView, 0, 0, canvas.width, canvas.height);

        // Process the captured image
        processImage(canvas.toDataURL("image/jpeg"));
      }

      function handleFileUpload() {
        const file = fileUpload.files[0];
        if (!file) return;

        if (!file.type.match("image.*")) {
          alert("Por favor, selecciona una imagen válida.");
          return;
        }

        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedImage.src = e.target.result;
          uploadPreview.classList.remove("hidden");
          processImage(e.target.result);
        };
        reader.readAsDataURL(file);
      }

      function processImage(imageData) {
        // Simulate AI processing with loading animation
        cameraSection.classList.add("hidden");
        uploadSection.classList.add("hidden");
        initialView.classList.add("hidden");

        resultSection.classList.remove("hidden");
        resultContent.innerHTML = `
                <div class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500 mb-4"></div>
                    <p class="text-gray-600">Analizando la imagen...</p>
                </div>
            `;

        // Simulate API call with timeout
        setTimeout(() => {
          showResult(getRandomWasteType());
        }, 2000);
      }

      function getRandomWasteType() {
        const types = Object.keys(wasteTypes);
        const randomIndex = Math.floor(Math.random() * types.length);
        return types[randomIndex];
      }

      function showResult(wasteType) {
        const waste = wasteTypes[wasteType];

        resultContent.innerHTML = `
                <div class="w-full mb-6">
                    <div class="flex items-center justify-center mb-4">
                        <div class="w-16 h-16 rounded-full ${waste.color} flex items-center justify-center mr-4">
                            <i class="${waste.icon} ${waste.textColor} text-2xl"></i>
                        </div>
                        <div>
                            <h4 class="text-xl font-semibold ${waste.textColor}">${waste.name}</h4>
                            <p class="text-gray-600">${waste.description}</p>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4 mb-4">
                        <h5 class="font-medium text-gray-700 mb-2"><i class="fas fa-trash-alt mr-2"></i>¿Dónde tirarlo?</h5>
                        <p class="text-gray-600 pl-8">${waste.disposal}</p>
                    </div>
                    
                    <div class="bg-white rounded-lg p-4">
                        <h5 class="font-medium text-gray-700 mb-2"><i class="fas fa-lightbulb mr-2"></i>Consejos</h5>
                        <p class="text-gray-600 pl-8">${waste.tips}</p>
                    </div>
                </div>
                
                <button id="ask-ai" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition mt-4">
                    <i class="fas fa-robot mr-2"></i>Preguntar al asistente sobre ${waste.name}
                </button>
            `;

        // Show result with animation
        setTimeout(() => {
          document.querySelector(".result-card").classList.add("show");
        }, 100);

        // Add event listener to the ask AI button
        document.getElementById("ask-ai")?.addEventListener("click", () => {
          askAboutWaste(wasteType);
        });
      }

      function sendAiMessage() {
        const message = aiInput.value.trim();
        if (!message) return;

        // Add user message to chat
        addChatMessage(message, "user");
        aiInput.value = "";

        // Simulate AI response
        setTimeout(() => {
          const responses = [
            "El reciclaje de este material es importante porque...",
            "Para este tipo de residuo, te recomiendo...",
            "Una alternativa interesante es reutilizarlo como...",
            "Según las normativas locales, este residuo debe...",
            "¿Sabías que reciclando esto puedes ayudar a...?",
          ];
          const randomResponse =
            responses[Math.floor(Math.random() * responses.length)];
          addChatMessage(randomResponse, "ai");
        }, 1000);
      }

      function addChatMessage(message, sender) {
        const messageDiv = document.createElement("div");
        messageDiv.className = `chat-message ${sender}-message mb-4`;

        if (sender === "user") {
          messageDiv.innerHTML = `
                    <div class="flex items-start justify-end">
                        <div class="bg-purple-600 text-white p-3 rounded-lg shadow-sm max-w-[85%]">
                            <p>${message}</p>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-purple-600 flex items-center justify-center ml-3">
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                    </div>
                `;
        } else {
          messageDiv.innerHTML = `
                    <div class="flex items-start">
                        <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center mr-3">
                            <i class="fas fa-robot text-purple-600 text-sm"></i>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow-sm max-w-[85%]">
                            <p class="text-gray-700">${message}</p>
                        </div>
                    </div>
                `;
        }

        aiChat.appendChild(messageDiv);
        aiChat.scrollTop = aiChat.scrollHeight;
      }

      function askAboutWaste(wasteType) {
        const waste = wasteTypes[wasteType];
        addChatMessage(
          `Tengo dudas sobre cómo reciclar ${waste.name.toLowerCase()}. ¿Podrías ayudarme?`,
          "user",
        );

        setTimeout(() => {
          let response = `Por supuesto. Los residuos ${waste.name.toLowerCase()} ${waste.description.toLowerCase()} `;
          response += `Deben depositarse en ${waste.disposal.toLowerCase()}. `;
          response += `Un consejo útil: ${waste.tips.toLowerCase()} `;
          response += `¿Necesitas más información sobre este tipo de residuo?`;

          addChatMessage(response, "ai");
        }, 1000);
      }
    </script>
  </body>
</html>
